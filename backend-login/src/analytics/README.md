# Система Аналитики

## Описание
Система аналитики предоставляет статистику по играм, пользователям и продажам для администраторов.

## API Endpoints

### GET /analytics/top-games
Получить топ игр по популярности
```
Query параметры:
- limit: количество игр (по умолчанию 10)
```

### GET /analytics/active-users
Получить статистику активных пользователей
```
Query параметры:
- days: период в днях (по умолчанию 7)
```

### GET /analytics/sales
Получить статистику продаж
```
Query параметры:
- days: период в днях (по умолчанию 30)
```

### GET /analytics/game/:gameName
Получить аналитику конкретной игры

### GET /analytics/user/:id
Получить аналитику пользователя (только для админов)

### GET /analytics/user
Получить собственную аналитику

## Метрики

### Топ игр
- Количество игроков
- Средний счет
- Общее время игры
- Рейтинг популярности

### Активные пользователи
- Количество активных пользователей
- Общее количество пользователей
- Новые пользователи
- Процент активности

### Продажи
- Общая выручка
- Количество транзакций
- Средний чек
- Статистика по валютам
- Статистика по источникам
- Ежедневная динамика

### Аналитика игры
- Общее количество игроков
- Средний счет
- Время игры
- Процент завершения
- Топ игроков

### Аналитика пользователя
- Общее количество игр
- Общий счет
- Время в играх
- Процент завершения
- Покупки
- Любимая игра
- Баланс

## Права доступа

- **Администраторы и создатели**: полный доступ ко всем метрикам
- **Обычные пользователи**: только собственная аналитика

## Интеграция с играми

Система автоматически собирает данные из:
- `GameProgress` - прогресс игроков
- `Leaderboard` - рейтинги
- `PurchaseHistory` - покупки
- `User` - информация о пользователях

## Примеры использования

### Получить топ-5 игр
```bash
GET /analytics/top-games?limit=5
```

### Статистика за последние 14 дней
```bash
GET /analytics/active-users?days=14
```

### Аналитика игры Snake
```bash
GET /analytics/game/snake
```

## Формат ответов

### Топ игр
```json
[
  {
    "gameName": "snake",
    "playersCount": 150,
    "averageScore": 850,
    "totalTimeSpent": 45000
  }
]
```

### Активные пользователи
```json
{
  "activeUsers": 45,
  "totalUsers": 200,
  "newUsers": 12,
  "activityRate": 22
}
```

### Продажи
```json
{
  "totalRevenue": 15000,
  "totalTransactions": 150,
  "averageTransactionValue": 100,
  "currencyStats": {
    "coins": { "count": 100, "total": 10000 },
    "crystals": { "count": 50, "total": 5000 }
  },
  "dailyStats": [
    {
      "date": "2024-01-15",
      "revenue": 500,
      "transactions": 5
    }
  ]
}
```

## Кэширование

Для оптимизации производительности рекомендуется кэшировать результаты аналитики:
- Топ игр: 1 час
- Активные пользователи: 15 минут
- Продажи: 30 минут
- Аналитика игры: 1 час




