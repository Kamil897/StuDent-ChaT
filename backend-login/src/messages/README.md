# Система Сообщений

## Описание
Система сообщений позволяет друзьям обмениваться личными сообщениями в реальном времени.

## Модели данных

### Message
- `id` - уникальный идентификатор
- `fromUserId` - ID отправителя
- `toUserId` - ID получателя
- `content` - текст сообщения
- `read` - прочитано ли сообщение
- `createdAt` - дата отправки

## API Endpoints

### POST /messages/send
Отправить сообщение другу
```json
{
  "toUserId": 123,
  "content": "Привет! Как дела?"
}
```

### GET /messages/:friendId
Получить историю переписки с другом

### POST /messages/:id/read
Отметить сообщение как прочитанное

### GET /messages/unread/count
Получить количество непрочитанных сообщений

### GET /messages/conversations/recent
Получить список последних переписок

## Ограничения

- Сообщения можно отправлять только друзьям
- Система автоматически проверяет статус дружбы
- Сообщения сохраняются в базе данных
- Поддерживается статус "прочитано"

## Интеграция с уведомлениями

При получении нового сообщения система может отправлять уведомления:

```typescript
// В MessagesService после создания сообщения
await notificationsService.push(toUserId, {
  type: 'message.new',
  title: `Новое сообщение от ${sender.name}`,
  body: message.content.substring(0, 50) + '...'
});
```

## Frontend интеграция

Для real-time обновлений рекомендуется использовать WebSocket или периодические запросы:

```javascript
// Проверка новых сообщений каждые 10 секунд
setInterval(async () => {
  const unreadCount = await getUnreadCount();
  updateNotificationBadge(unreadCount);
}, 10000);
```

## Форматирование сообщений

Сообщения поддерживают:
- Обычный текст
- Эмодзи
- Переносы строк
- Максимальная длина: 1000 символов

## Безопасность

- Проверка авторизации для всех операций
- Валидация входных данных
- Защита от XSS атак
- Ограничение частоты отправки сообщений




